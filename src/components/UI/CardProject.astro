---
import { Image } from "astro:assets"
import type { ImageMetadata } from "astro"
import { getImage } from "astro:assets"

interface Props {
  slug: string
  imagen: string
  nombre: string
  descripcion: string
}

const { slug, imagen, nombre, descripcion } = Astro.props

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/img-projects/*.{jpeg,jpg,png,gif}"
)

const imageEntries = await Promise.all(
  Object.entries(images).map(async ([path, image]) => {
    const img = await image()

    const optimizedImage = await getImage({
      src: img.default,
      width: 400,
      format: "webp",
      quality: 80
    })

    return {
      optimized: optimizedImage
    }
  })
)
---

<a
  href={slug}
  class="hover:ring-4 hover:transition hover:ring-blue-500 rounded-2xl group"
>
  <div
    class="bg-gradient-to-tr from-cyan-400/5 to-blue-600/30 p-4 group-hover:scale-95 transition ease-in delay-75 h-full overflow-hidden ring-gray-900/5 sm:mx-auto sm:max-w-lg rounded-2xl"
  >
    <Image
      transition:name={`cover-project-${slug}`}
      src={imageEntries[imagen].optimized.src}
      class="w-full aspect-video object-cover rounded-2xl mb-5"
      decoding="async"
      height="286"
      width="229"
      alt={`proyecto ${nombre}`}
    />
    <main class="flex-auto min-w-full px-3">
      <h2 class="dark:text-white text-neutral-800 text-2xl font-medium mb-0">
        {nombre}
      </h2>
      <p
        class="max-w-sm dark:text-neutral-200 text-gray-700 text-base text-pretty"
      >
        {descripcion}
      </p>
    </main>
  </div>
</a>
